SELECT CODIGO, 
	     COR, 
	      TAM, 
	      BARRA, 
	      TIPO, 
	      DEPOSITO, 
	      LOTE, 
	      LOCAL,
	      QUANTIDADE_ESTOQUE, 
	      QTDE_MOV, 
	      DIFERENCA FROM (
    SELECT PA.CODIGO, PA.COR, PA.TAM, PA.BARRA, PA.TIPO, PA.DEPOSITO, PA.LOTE, PA.LOCAL, PA.QUANTIDADE AS QUANTIDADE_ESTOQUE, 
    SUM(CASE WHEN PAMOV.OPERACAO = 'E' THEN PAMOV.QTDE ELSE (PAMOV.QTDE * -1) END) AS QTDE_MOV, 
    ABS((SUM(CASE WHEN PAMOV.OPERACAO = 'E' THEN PAMOV.QTDE ELSE (PAMOV.QTDE * -1) END) - PA.QUANTIDADE)) AS DIFERENCA
    FROM PA_MOV_001 PAMOV
    INNER JOIN PA_ITEN_001 PA
    ON (PAMOV.CODIGO = PA.CODIGO) AND (PAMOV.COR = PA.COR) AND (PAMOV.TAMANHO = PA.TAM) 
    AND (PAMOV.DEPOSITO = PA.DEPOSITO) AND (PAMOV.TIPO = PA.TIPO) 
    AND (PAMOV.LOTE = PA.LOTE) AND (PAMOV.LOCAL = PA.LOCAL)
    GROUP BY
    PA.DEPOSITO, 
    PA.CODIGO, 
    PA.COR, 
    PA.TAM, 
    PA.BARRA, 
    PA.TIPO, 
    PA.LOTE, 
    PA.LOCAL,
    PA.QUANTIDADE)
WHERE DIFERENCA <> 0
