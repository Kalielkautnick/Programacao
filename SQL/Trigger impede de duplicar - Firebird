--NÓS TIVEMOS QUE MONTAR ESSA TRIGGER EM UM CLIENTE QUE ESTAVA COM UM PROBLEMA HÁ BASTANTE TEMPO DE DUPLICAÇÃO DE 
REGISTRO NA TABELA, E NÃO CONSEGUIAMOS ENCONTRAR O PROBLEMA, ENTÃO CRIEI ESSA TRIGGER QUE FAZ UM INSERT NOS LOGS PARA DESCOBRIMOS
EM QUAL MOMENTO ISSO ACONTECIA (RESOLVEU NOSSO PROBLEMA DIAS DEPOIS).

CREATE OR REPLACE TRIGGER IMPEDE_DUPLICAR_FACCAO 
AFTER UPDATE OR INSERT OR DELETE ON FACCAO_001
FOR EACH NOW
BEGIN
  SELECT COUNT(*) AS V_COUNT
       FROM FACCAO_001
       WHERE CODIGO = NEW.CODIGO 
       AND MOV_ABA ='5'
       GROUP BY NUMERO,
                CODIGO,
                COR,
                TAM,
                QT_ORIG,
                MOV,
                OP,
                PARTE,
                CODCLI
      HAVING COUNT(*) > 1
      
INTO :V_COUNT;

     IF (V_COUNT > 1) THEN
   BEGIN
   	INSERT INTO LOG (USUARIO, DATA, HORA, TELA, DESCRICAO, EMPRESA, CHAVE, OPERACAO, FORM)
   		VALUES 
   	('SISPLAN', CURRENT_DATE, CURRENT_TIME, 'TRIGGER', 'REGISTRO DUPLICADO FACCAO: '|| NEW.NUMERO || 
    ' - COR: ' || NEW.COR || ' - TAM: '|| NEW.TAM || ' MOV: '|| NEW.MOV , '','TRIGGER','MOVIMENTA PARTE','FACMOV3');
    EXCEPTION FAC_DUPLICADA;
   END  
END
