UPDATE PED_ITEN_001 P SET P.PERC_COMISSAO =  
CASE WHEN
--SE O ITEM TIVER O PREÇO IGUAL AO PREÇO ORIGINAL, O PERCENTUAL DE COMISSÃO SERÁ 10% 
	(SELECT COUNT(*) AS CNT FROM PED_ITEN_001 PI 
	WHERE EXISTS 
	(SELECT PED.NUMERO FROM PED_ITEN_001 PED WHERE PED.NUMERO=PI.NUMERO AND PED.COR=PI.COR AND PED.TAM=PI.TAM AND PED.PRECO=PED.PRECO_ORIG)
 	AND PI.NUMERO=P.NUMERO AND PI.CODIGO=P.CODIGO AND PI.COR=P.COR AND PI.TAM=P.TAM) > 0
THEN 10
--SE TIVER ALGUM ITEM QUE O PREÇO DELE SEJA PELO MENOS 10% MENOR QUE O PREÇO ORIGINAL, A COMISSÃO SERÁ DE 5.2%
WHEN
    	(SELECT COUNT(*) AS CNT FROM PED_ITEN_001 PI 
	WHERE EXISTS 
    	(SELECT PED.NUMERO FROM PED_ITEN_001 PED WHERE PED.NUMERO=PI.NUMERO AND PED.COR=PI.COR AND PED.TAM=PI.TAM AND 
    	(PED.PRECO * (1 + 0.1) <= PED.PRECO_ORIG)) 
	AND PI.NUMERO=P.NUMERO AND PI.CODIGO=P.CODIGO AND PI.COR=P.COR AND PI.TAM=P.TAM) > 0
THEN 5.2
--SE TIVER ALGUM ITEM QUE O PREÇO DELE SEJA ENTRE 8% E 10% MENOR QUE O PREÇO ORIGINAL, A COMISSÃO SERÁ DE 8.16%
WHEN
	(SELECT COUNT(*) AS CNT FROM PED_ITEN_001 PI
	WHERE EXISTS 
	(SELECT PED.NUMERO FROM PED_ITEN_001 PED WHERE PED.NUMERO=PI.NUMERO AND PED.COR=PI.COR AND PED.TAM=PI.TAM AND
	(PED.PRECO * (1 + 0.08) <= PED.PRECO_ORIG)) 
	AND PI.NUMERO=P.NUMERO AND PI.CODIGO=P.CODIGO AND PI.COR=P.COR AND PI.TAM=P.TAM) > 0
THEN 8.16
--SE TIVER ALGUM ITEM QUE O PREÇO DELE SEJA ENTRE 5% E 7,99% MENOR QUE O PREÇO ORIGINAL, A COMISSÃO SERÁ DE 9.28%
WHEN
	(SELECT COUNT(*) AS CNT FROM PED_ITEN_001 PI
	WHERE EXISTS 
	(SELECT PED.NUMERO FROM PED_ITEN_001 PED WHERE PED.NUMERO=PI.NUMERO AND PED.COR=PI.COR AND PED.TAM=PI.TAM AND 
	(PED.PRECO * (1 + 0.05) <= PED.PRECO_ORIG)) 
	AND PI.NUMERO=P.NUMERO AND PI.CODIGO=P.CODIGO AND PI.COR=P.COR AND PI.TAM=P.TAM) > 0
THEN 9.28
--SE TIVER PREÇO ENTRE 0,01% E 4,99%, A COMISSÃO SERÁ DE 9.54%
WHEN
	(SELECT COUNT(*) AS CNT FROM PED_ITEN_001 PI
	WHERE EXISTS 
	(SELECT PED.NUMERO FROM PED_ITEN_001 PED WHERE PED.NUMERO=PI.NUMERO AND PED.COR=PI.COR AND PED.TAM=PI.TAM AND 
	(PED.PRECO * (1 + 0.001) <= PED.PRECO_ORIG)) 
	AND PI.NUMERO=P.NUMERO AND PI.CODIGO=P.CODIGO AND PI.COR=P.COR AND PI.TAM=P.TAM) > 0
THEN 9.54
-- SE O PREÇO ESTIVER MAIOR QUE O PREÇO ORIGINAL, A COMISSÃO SERÁ DE 10% + ((VALOR ACIMA DO ORIGINAL * 10) / 100)
WHEN
      (SELECT 10 + (((PRECO - PRECO_ORIG) * 10) / 100) FROM PED_ITEN_001 PI 
	WHERE EXISTS 
	(SELECT PED.NUMERO FROM PED_ITEN_001 PED WHERE PED.NUMERO=PI.NUMERO AND PED.COR=PI.COR AND PED.TAM=PI.TAM AND PED.PRECO>PED.PRECO_ORIG) 
 	AND PI.NUMERO=P.NUMERO AND PI.CODIGO=P.CODIGO AND PI.COR=P.COR AND PI.TAM=P.TAM)

ELSE 0
END
WHERE P.NUMERO IN (
'00042',
'00409',
'00470',
'00522'
)
