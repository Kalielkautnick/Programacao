---ESSE UPDATE FOI CRIADO PARA CORRIGIR A TABELA DE ESTOQUE INTEIRA EM UM CLIENTE, SETANDO A QUANTIDADE EM ESTOQUE
---IGUAL AO SALDO DE ENTRADAS E SAÍDAS DO PRODUTO, PORQUE O ESTOQUE DO CLIENTE ESTAVA TODO ERRADO E A ÚNICA TABELA QUE ESTAVA CORRETA
---ERA A TABELA DE MOVIMENTAÇÕES

UPDATE PA_ITEN_001 PA SET PA.QUANTIDADE = 
(SELECT UDF_NVL(SUM(CASE WHEN PAMOV.OPERACAO = 'E' THEN PAMOV.QTDE ELSE (PAMOV.QTDE * -1) END)) AS QTDE
   FROM PA_MOV_001 PAMOV 
   WHERE PAMOV.CODIGO = PA.CODIGO 
   AND PAMOV.COR = PA.COR 
   AND PAMOV.TAMANHO = PA.TAM 
   AND PAMOV.DEPOSITO = PA.DEPOSITO 
   AND PAMOV.LOTE = PA.LOTE
   AND PAMOV.LOCAL = PA.LOCAL
   AND PAMOV.TIPO = PA.TIPO)
WHERE 1=1
