SELECT
      NUMERO,
	CODIGO,
	DESC_CODIGO,
	UNI_VENDA,
	COR,
	DESCRICAO,
	SUM(QUANTIDADE) AS QUANTIDADE_COR,
	PRECO,
    SUM(QUANTIDADE * COALESCE(PRECO),0) AS VALOR_BRUTO,
    SUM((QUANTIDADE * COALESCE(PRECO),0) * (1 - (PER_DESC / 100)))  AS VALOR_LIQ,                         
	COALESCE(SUM(QT1),0) AS QT1,
	COALESCE(SUM(QT2),0) AS QT2,
	COALESCE(SUM(QT3),0) AS QT3,
	COALESCE(SUM(QT4),0) AS QT4,
	COALESCE(SUM(QT5),0) AS QT5,
	COALESCE(SUM(QT6),0) AS QT6,
	COALESCE(SUM(QT7),0) AS QT7,
	COALESCE(SUM(QT8),0) AS QT8,
	COALESCE(SUM(QT9),0) AS QT9,
	COALESCE(SUM(QT10),0) AS QT10,
	MAX(TAM1) AS TAM1,
	MAX(TAM2) AS TAM2,
	MAX(TAM3) AS TAM3,
	MAX(TAM4) AS TAM4,
	MAX(TAM5) AS TAM5,
	MAX(TAM6) AS TAM6,
	MAX(TAM7) AS TAM7,
	MAX(TAM8) AS TAM8,
	MAX(TAM9) AS TAM9,
	MAX(TAM10) AS TAM10
FROM
	(
	SELECT
            NUMERO,
		CODIGO,
		DESC_CODIGO,
		UNI_VENDA,
		COR,
		DESCRICAO,
		FAIXA,
		SUM(QUANTIDADE) AS QUANTIDADE,
		PRECO,
            PER_DESC,                             
		CASE
			WHEN POSICAO = 1 THEN SUM(QUANTIDADE)
		END AS QT1,
		CASE
			WHEN POSICAO = 2 THEN SUM(QUANTIDADE)
		END AS QT2,
		CASE
			WHEN POSICAO = 3 THEN SUM(QUANTIDADE)
		END AS QT3,
		CASE
			WHEN POSICAO = 4 THEN SUM(QUANTIDADE)
		END AS QT4,
		CASE
			WHEN POSICAO = 5 THEN SUM(QUANTIDADE)
		END AS QT5,
		CASE
			WHEN POSICAO = 6 THEN SUM(QUANTIDADE)
		END AS QT6,
		CASE
			WHEN POSICAO = 7 THEN SUM(QUANTIDADE)
		END AS QT7,
		CASE
			WHEN POSICAO = 8 THEN SUM(QUANTIDADE)
		END AS QT8,
		CASE
			WHEN POSICAO = 9 THEN SUM(QUANTIDADE)
		END AS QT9,
		CASE
			WHEN POSICAO = 10 THEN SUM(QUANTIDADE)
		END AS QT10,
		CASE
			WHEN POSICAO = 1 THEN MAX(TAM) ELSE '   -'
		END AS TAM1,
		CASE
			WHEN POSICAO = 2 THEN MAX(TAM) ELSE '   -'
		END AS TAM2,
		CASE
			WHEN POSICAO = 3 THEN MAX(TAM) ELSE '   -'
		END AS TAM3,
		CASE
			WHEN POSICAO = 4 THEN MAX(TAM) ELSE '   -'
		END AS TAM4,
		CASE
			WHEN POSICAO = 5 THEN MAX(TAM) ELSE '   -'
		END AS TAM5,
		CASE
			WHEN POSICAO = 6 THEN MAX(TAM) ELSE '   -'
		END AS TAM6,
		CASE
			WHEN POSICAO = 7 THEN MAX(TAM) ELSE '   -'
		END AS TAM7,
		CASE
			WHEN POSICAO = 8 THEN MAX(TAM) ELSE '   -'
		END AS TAM8,
		CASE
			WHEN POSICAO = 9 THEN MAX(TAM) ELSE '   -'
		END AS TAM9,
		CASE
			WHEN POSICAO = 10 THEN MAX(TAM) ELSE '   -'
		END AS TAM10
	FROM
		(
		SELECT
                  PED_ITEN.NUMERO,
			PED_ITEN.CODIGO,
			PRODUTO.DESCRICAO AS DESC_CODIGO,
			PRODUTO.UNI_VENDA,
			PED_ITEN.COR,
			CADCOR.DESCRICAO,
			FAIXA_ITEN.POSICAO,
			PED_ITEN.TAM,
			SUM((PED_ITEN.QTDE_F + PED_ITEN.QTDE)) AS QUANTIDADE,
			PED_ITEN.PRECO,
                  PEDIDO.PER_DESC,                                     
			FAIXA_ITEN.FAIXA
		FROM
			PEDIDO_001 PEDIDO
		INNER JOIN PED_ITEN_001 PED_ITEN ON
			(PEDIDO.NUMERO = PED_ITEN.NUMERO)
		LEFT JOIN PRODUTO_001 PRODUTO ON
			(PED_ITEN.CODIGO = PRODUTO.CODIGO)
		LEFT JOIN UNIDADE_001 UNIDADE ON
			(PRODUTO.UNIDADE = UNIDADE.UNIDADE)
		LEFT JOIN ENTIDADE_001 CLIENTE ON
			(PEDIDO.CODCLI = CLIENTE.CODCLI)
		LEFT JOIN CADCOR_001 CADCOR ON
			(PED_ITEN.COR = CADCOR.COR)
		LEFT JOIN FAIXA_ITEN_001 FAIXA_ITEN ON
			(PRODUTO.FAIXA = FAIXA_ITEN.FAIXA
			AND PED_ITEN.TAM = FAIXA_ITEN.TAMANHO)
		WHERE
			1 = 1
			AND PEDIDO.NUMERO = '01598'
		GROUP BY
                  PED_ITEN.NUMERO,
			PED_ITEN.CODIGO,
			PRODUTO.DESCRICAO,
			PRODUTO.UNI_VENDA,
			PED_ITEN.COR,
			CADCOR.DESCRICAO,
			FAIXA_ITEN.POSICAO,
			PED_ITEN.TAM,
			PED_ITEN.PRECO, 
PEDIDO.PER_DESC,                                    
			FAIXA_ITEN.FAIXA
		HAVING
			SUM(COALESCE(PED_ITEN.QTDE_F) + PED_ITEN.QTDE + PED_ITEN.QTDE_CANC) > 0
		ORDER BY
			PED_ITEN.CODIGO,
			FAIXA_ITEN.POSICAO ) TEMP
	GROUP BY
            NUMERO,
		CODIGO,
		DESC_CODIGO,
		UNI_VENDA,
		COR,
		DESCRICAO,
		POSICAO,
		FAIXA,
  PRECO, 
PER_DESC ) TEMP2
GROUP BY
 TEMP2.NUMERO,
	TEMP2.CODIGO,
	TEMP2.DESC_CODIGO,
	TEMP2.UNI_VENDA,
	TEMP2.COR,
	TEMP2.DESCRICAO,
	TEMP2.FAIXA,
	TEMP2.PRECO                                      
ORDER BY
	TEMP2.NUMERO, TEMP2.CODIGO, TEMP2.FAIXA, COR